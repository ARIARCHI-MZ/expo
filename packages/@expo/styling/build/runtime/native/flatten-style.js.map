{"version":3,"file":"flatten-style.js","sourceRoot":"","sources":["../../../src/runtime/native/flatten-style.ts"],"names":[],"mappings":"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","sourcesContent":["import { isRuntimeValue } from '../../shared';\nimport { Interaction, RuntimeValue, Style, StyleMeta, StyleProp } from '../../types';\nimport { testContainerQuery, testMediaQuery, testPseudoClasses } from './conditions';\nimport { rem, styleMetaMap, vh, vw } from './globals';\n\nexport interface FlattenStyleOptions {\n  variables: Record<string, any>;\n  interaction?: Interaction;\n  containers?: Record<string, any>;\n  ch?: number;\n  cw?: number;\n}\n\n/**\n * Reduce a StyleProp to a flat Style object.\n *\n * @remarks\n * As we loop over keys & values, we will resolve any dynamic values.\n * Some values cannot be calculated until the entire style has been flattened.\n * These values are defined as a getter and will be resolved lazily.\n *\n * @param styles The style or styles to flatten.\n * @param options The options for flattening the styles.\n * @param flatStyle The flat style object to add the flattened styles to.\n * @returns The flattened style object.\n */\nexport function flattenStyle(\n  styles: StyleProp,\n  options: FlattenStyleOptions,\n  flatStyle?: Style\n): Style {\n  let flatStyleMeta: StyleMeta;\n\n  if (!flatStyle) {\n    flatStyle = {};\n    flatStyleMeta = {};\n    styleMetaMap.set(flatStyle, flatStyleMeta);\n  } else {\n    flatStyleMeta = styleMetaMap.get(flatStyle) ?? {};\n  }\n\n  if (!styles) {\n    return flatStyle;\n  }\n\n  if (Array.isArray(styles)) {\n    // We need to flatten in reverse order so that the last style in the array is the one defined\n    for (let i = styles.length - 1; i >= 0; i--) {\n      if (styles[i]) {\n        flattenStyle(styles[i], options, flatStyle);\n      }\n    }\n    return flatStyle;\n  }\n\n  // The is the metadata for the style object.\n  // It contains information is like the MediaQuery data\n  //\n  // Note: This is different to flatStyleMeta, which is the metadata\n  // for the FLATTENED style object\n  const styleMeta = styleMetaMap.get(styles) || {};\n\n  /*\n   * TODO: Investigate if we early exit if there is no styleMeta.\n   */\n\n  /*\n   * START OF CONDITIONS CHECK\n   *\n   * If any of these fail, this style and its metadata will be skipped\n   */\n  if (styleMeta.pseudoClasses) {\n    flatStyleMeta.pseudoClasses = {\n      ...styleMeta.pseudoClasses,\n      ...flatStyleMeta.pseudoClasses,\n    };\n\n    if (!testPseudoClasses(options.interaction, styleMeta.pseudoClasses)) {\n      return flatStyle;\n    }\n  }\n\n  // Skip failed media queries\n  if (styleMeta.media && !styleMeta.media.every((m) => testMediaQuery(m))) {\n    return flatStyle;\n  }\n\n  if (!testContainerQuery(styleMeta.containerQuery, options.containers)) {\n    return flatStyle;\n  }\n  /*\n   * END OF CONDITIONS CHECK\n   */\n  if (styleMeta.animations) {\n    flatStyleMeta.animations = {\n      ...styleMeta.animations,\n      ...flatStyleMeta.animations,\n    };\n  }\n\n  if (styleMeta.transition) {\n    flatStyleMeta.transition = {\n      ...styleMeta.transition,\n      ...flatStyleMeta.transition,\n    };\n  }\n\n  if (styleMeta.container) {\n    flatStyleMeta.container ??= { type: 'normal', names: [] };\n\n    if (styleMeta.container.names) {\n      flatStyleMeta.container.names = styleMeta.container.names;\n    }\n    if (styleMeta.container.type) {\n      flatStyleMeta.container.type = styleMeta.container.type;\n    }\n  }\n\n  if (styleMeta.requiresLayout) {\n    flatStyleMeta.requiresLayout = true;\n  }\n\n  if (styleMeta.variables) {\n    flatStyleMeta.variables ??= {};\n    for (const [key, value] of Object.entries(styleMeta.variables)) {\n      // Skip already set variables\n      if (key in flatStyleMeta.variables) continue;\n\n      const getterOrValue = extractValue(value, flatStyle, flatStyleMeta, options);\n\n      if (typeof getterOrValue === 'function') {\n        Object.defineProperty(flatStyleMeta.variables, key, {\n          enumerable: true,\n          get() {\n            return getterOrValue();\n          },\n        });\n      } else {\n        flatStyleMeta.variables[key] = getterOrValue;\n      }\n    }\n  }\n\n  for (const [key, value] of Object.entries(styles)) {\n    // Skip already set keys\n    if (key in flatStyle) continue;\n\n    if (key === 'transform') {\n      const transforms: Record<string, unknown>[] = [];\n\n      for (const transform of value) {\n        // Transform is either an React Native transform object OR\n        // A extracted value with type: \"function\"\n        if ('type' in transform) {\n          const getterOrValue = extractValue(transform, flatStyle, flatStyleMeta, options);\n\n          if (getterOrValue === undefined) {\n            continue;\n          } else if (typeof getterOrValue === 'function') {\n            transforms.push(\n              Object.defineProperty({}, transform.name, {\n                configurable: true,\n                enumerable: true,\n                get() {\n                  return getterOrValue();\n                },\n              })\n            );\n          }\n        } else {\n          for (const [tKey, tValue] of Object.entries(transform)) {\n            const $transform: Record<string, any> = {};\n\n            const getterOrValue = extractValue(tValue, flatStyle, flatStyleMeta, options);\n\n            if (typeof getterOrValue === 'function') {\n              Object.defineProperty($transform, tKey, {\n                configurable: true,\n                enumerable: true,\n                get() {\n                  return getterOrValue();\n                },\n              });\n            } else {\n              $transform[tKey] = getterOrValue;\n            }\n\n            transforms.push($transform);\n          }\n        }\n      }\n\n      flatStyle.transform = transforms as any;\n    } else {\n      const getterOrValue = extractValue(value, flatStyle, flatStyleMeta, options);\n\n      if (typeof getterOrValue === 'function') {\n        Object.defineProperty(flatStyle, key, {\n          configurable: true,\n          enumerable: true,\n          get() {\n            return getterOrValue();\n          },\n        });\n      } else {\n        flatStyle[key as keyof Style] = getterOrValue;\n      }\n    }\n  }\n\n  return flatStyle;\n}\n\n/**\n * Extracts a value from a StyleProp.\n * If the value is a dynamic value, it will be resolved.\n * @param value - The value to extract.\n * @param flatStyle - The flat Style object being built.\n * @param flatStyleMeta - Metadata for the flat Style object.\n * @param options - Options for flattening the StyleProp.\n * @returns The extracted value.\n */\nfunction extractValue(\n  value: unknown,\n  flatStyle: Style,\n  flatStyleMeta: StyleMeta,\n  options: FlattenStyleOptions\n): any {\n  if (isRuntimeValue(value)) {\n    switch (value.name) {\n      case 'vh':\n        return round((vh.get() / 100) * (value.arguments[0] as number));\n      case 'vw':\n        return round((vw.get() / 100) * (value.arguments[0] as number));\n      case 'var':\n        return () => {\n          const name = value.arguments[0] as string;\n          const resolvedValue = flatStyleMeta.variables?.[name] ?? options.variables[name];\n          return typeof resolvedValue === 'function' ? resolvedValue() : resolvedValue;\n        };\n      case 'rem':\n        return round(rem.get() * (value.arguments[0] as number));\n      case 'em':\n        return () => {\n          const multiplier = value.arguments[0] as number;\n          if ('fontSize' in flatStyle) {\n            return round((flatStyle.fontSize || 0) * multiplier);\n          }\n          return undefined;\n        };\n      case 'ch': {\n        const multiplier = value.arguments[0] as number;\n\n        let reference: number | undefined;\n\n        if (options.ch) {\n          reference = options.ch;\n        } else if (options.interaction?.layout.height.get()) {\n          reference = options.interaction.layout.height.get();\n        } else if (typeof flatStyle.height === 'number') {\n          reference = flatStyle.height;\n        }\n\n        if (reference) {\n          return round(reference * multiplier);\n        } else {\n          return () => {\n            if (options.interaction?.layout.height.get()) {\n              reference = options.interaction.layout.height.get();\n            } else if (typeof flatStyle.height === 'number') {\n              reference = flatStyle.height;\n            } else {\n              reference = 0;\n            }\n\n            return round(reference * multiplier);\n          };\n        }\n      }\n      case 'cw': {\n        const multiplier = value.arguments[0] as number;\n\n        let reference: number | undefined;\n\n        if (options.cw) {\n          reference = options.cw;\n        } else if (options.interaction?.layout.width.get()) {\n          reference = options.interaction.layout.width.get();\n        } else if (typeof flatStyle.width === 'number') {\n          reference = flatStyle.width;\n        }\n\n        if (reference) {\n          return round(reference * multiplier);\n        } else {\n          return () => {\n            if (options.interaction?.layout.width.get()) {\n              reference = options.interaction.layout.width.get();\n            } else if (typeof flatStyle.width === 'number') {\n              reference = flatStyle.width;\n            } else {\n              reference = 0;\n            }\n\n            return round(reference * multiplier);\n          };\n        }\n      }\n      case 'perspective':\n      case 'translateX':\n      case 'translateY':\n      case 'scaleX':\n      case 'scaleY':\n      case 'scale':\n        return extractRuntimeFunction(value, flatStyle, flatStyleMeta, options, {\n          shouldRunwrap: true,\n          shouldParseFloat: true,\n        });\n      case 'rotate':\n      case 'rotateX':\n      case 'rotateY':\n      case 'rotateZ':\n      case 'skewX':\n      case 'skewY':\n        return extractRuntimeFunction(value, flatStyle, flatStyleMeta, options, {\n          shouldRunwrap: true,\n        });\n      default: {\n        return extractRuntimeFunction(value, flatStyle, flatStyleMeta, options);\n      }\n    }\n  }\n\n  return value;\n}\n\nfunction extractRuntimeFunction(\n  value: RuntimeValue,\n  flatStyle: Style,\n  flatStyleMeta: StyleMeta,\n  options: FlattenStyleOptions,\n  { shouldRunwrap = false, shouldParseFloat = false } = {}\n) {\n  let isStatic = true;\n  const args: unknown[] = [];\n\n  for (const arg of value.arguments) {\n    const getterOrValue = extractValue(arg, flatStyle, flatStyleMeta, options);\n\n    if (typeof getterOrValue === 'function') {\n      isStatic = false;\n    }\n\n    args.push(getterOrValue);\n  }\n\n  const valueFn = () => {\n    const $args = args\n      .map((a) => (typeof a === 'function' ? a() : a))\n      .filter((a) => a !== undefined)\n      .join(', ');\n\n    if ($args === '') {\n      return;\n    }\n\n    const result = shouldRunwrap ? $args : `${value.name}(${$args})`;\n    return shouldParseFloat ? parseFloat(result) : result;\n  };\n\n  return isStatic ? valueFn() : valueFn;\n}\n\nfunction round(number: number) {\n  return Math.round((number + Number.EPSILON) * 100) / 100;\n}\n"]}