{"version":3,"file":"stylesheet.js","sourceRoot":"","sources":["../../../src/runtime/native/stylesheet.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Dimensions,\n  StyleSheet as RNStyleSheet,\n  Appearance,\n} from \"react-native\";\n\nimport {\n  StyleSheetRegisterOptions,\n  ExtractedStyle,\n  StyleProp,\n  StyleMeta,\n} from \"../../types\";\nimport {\n  animationMap,\n  colorScheme,\n  globalStyles,\n  rem,\n  styleMetaMap,\n  vh,\n  vw,\n} from \"./globals\";\n\nconst subscriptions = new Set<() => void>();\n\n/**\n * This is a custom wrapper around the React Native Stylesheet.\n * It allows us to intercept the creation of styles and \"tag\" them wit the metadata\n */\nconst parialStyleSheet = {\n  rem,\n  __subscribe(subscription: () => void) {\n    subscriptions.add(subscription);\n    return () => {\n      subscriptions.delete(subscription);\n    };\n  },\n  __reset({ dimensions = Dimensions, appearance = Appearance } = {}) {\n    globalStyles.clear();\n    rem.reset();\n    vw.reset(dimensions);\n    vh.reset(dimensions);\n    colorScheme.reset(appearance);\n  },\n  register: (options: StyleSheetRegisterOptions) => {\n    if (options.keyframes) {\n      for (const [name, keyframes] of Object.entries(options.keyframes)) {\n        animationMap.set(name, keyframes);\n      }\n    }\n\n    if (options.declarations) {\n      for (const [name, styles] of Object.entries(options.declarations)) {\n        globalStyles.set(name, tagStyles(styles));\n      }\n    }\n\n    for (const subscription of subscriptions) {\n      subscription();\n    }\n  },\n  create: (styles: Record<string, ExtractedStyle>) => {\n    const namedStyles: Record<string, StyleProp> = {};\n\n    for (const [name, style] of Object.entries(styles)) {\n      namedStyles[name] = tagStyles(style);\n    }\n\n    for (const subscription of subscriptions) {\n      subscription();\n    }\n\n    return namedStyles;\n  },\n};\n\nexport const StyleSheet = Object.assign({}, RNStyleSheet, parialStyleSheet);\n\nfunction tagStyles(styles: ExtractedStyle | ExtractedStyle[]): StyleProp {\n  if (Array.isArray(styles)) {\n    let didTag = false;\n    const taggedStyles = styles.map((s) => {\n      const taggedStyle = tagStyles(s);\n      didTag ||= styleMetaMap.has(s.style);\n      return taggedStyle;\n    });\n\n    if (didTag) {\n      styleMetaMap.set(taggedStyles, {});\n    }\n\n    return taggedStyles;\n  } else {\n    const meta: StyleMeta = {};\n    let hasMeta = false;\n\n    if (styles.isDynamic) {\n      hasMeta = true;\n    }\n\n    if (styles.variables) {\n      meta.variables = styles.variables;\n      hasMeta = true;\n    }\n\n    if (Array.isArray(styles.media) && styles.media.length > 0) {\n      meta.media = styles.media;\n      hasMeta = true;\n    }\n\n    if (styles.pseudoClasses) {\n      meta.pseudoClasses = styles.pseudoClasses;\n      hasMeta = true;\n    }\n\n    if (styles.animations) {\n      meta.animations = styles.animations;\n      hasMeta = true;\n\n      const requiresLayout = styles.animations.name?.some((nameObj) => {\n        const name = nameObj.type === \"none\" ? \"none\" : nameObj.value;\n        return animationMap.get(name)?.requiresLayout;\n      });\n\n      if (requiresLayout) {\n        meta.requiresLayout = true;\n      }\n    }\n\n    if (styles.container) {\n      meta.container = {\n        names: styles.container.names,\n        type: styles.container.type ?? \"normal\",\n      };\n      hasMeta = true;\n    }\n\n    if (styles.containerQuery) {\n      meta.containerQuery = styles.containerQuery;\n      hasMeta = true;\n    }\n\n    if (styles.transition) {\n      meta.transition = styles.transition;\n      hasMeta = true;\n    }\n    if (styles.requiresLayout) {\n      meta.requiresLayout = styles.requiresLayout;\n      hasMeta = true;\n    }\n\n    if (hasMeta) {\n      styleMetaMap.set(styles.style, meta);\n    }\n\n    return styles.style;\n  }\n}\n"]}